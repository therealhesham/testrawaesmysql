# خطة اختبار النظام الشاملة (System Testing Plan)

تهدف هذه الوثيقة إلى توفير إطار عمل شامل لاختبار نظام إدارة الاستقدام والعمالة، وتغطي جميع الوحدات الرئيسية من وجهة نظر المستخدم (Admin) والعميل والموظفين.

## 1. نظرة عامة والنطاق (Overview & Scope)
يشمل الاختبار الوحدات التالية:
- **إدارة المستخدمين والصلاحيات:** (User & Role Management)
- **إدارة العملاء:** (Client Management)
- **إدارة الطلبات والعقود:** (Order & Contract Management)
- **الموارد البشرية (العاملات):** (HR & Homemaids)
- **العمليات اللوجستية (الوصول، الإيواء، نقل الكفالة):** (Logistics & Operations)
- **المالية والمحاسبة:** (Finance & Accounting)

---

## 2. بيئة الاختبار (Testing Environment)
- **المتصفح:** ينصح باستخدام Google Chrome و Edge لاختبار التوافق.
- **قاعدة البيانات:** نسخة محلية أو نسخة Staging مفصولة عن الإنتاج.
- **الحسابات:**
    - حساب `Admin` بصلاحيات كاملة.
    - حساب `Employee` بصلاحيات محدودة (للتحقق من الأذونات).
    - حساب `Client` (للبوابة الخارجية إن وجدت).

---

## 3. خطة اختبار الوحدات (Module Test Plans)

### 3.1 إدارة المستخدمين والصلاحيات (Admin & Permissions)
صفحات: `/admin/users`, `/admin/permissions`
| الحالة (Case) | الخطوات (Steps) | النتيجة المتوقعة (Expected Result) |
|---|---|---|
| **تسجيل الدخول** | إدخال اسم مستخدم وكلمة مرور صحيحين | التوجيه للوحة التحكم وإنشاء Session |
| **فشل الدخول** | إدخال بيانات خاطئة | رسالة خطأ واضحة وعدم التوجيه |
| **إضافة دور (Role)** | إنشاء دور جديد (مثلاً: "مشرف مبيعات") وتحديد صلاحيات معينة | ظهور الدور في القائمة وحفظه في DB |
| **تعيين دور لمستخدم** | تعديل مستخدم وتغيير دوره إلى الدور الجديد | تحديث صلاحيات المستخدم فوراً أو عند الدخول التالي |
| **اختبار الصلاحيات** | محاولة دخول مستخدم "مشرف مبيعات" لصفحة "التقارير المالية" (غير مصرح له) | رسالة "غير مصرح" (Unauthorized) أو إخفاء الرابط |

### 3.2 إدارة العملاء (Client Management)
صفحات: `/admin/client-accounts`, `/admin/clients`, `AddClientModal`
| الحالة | الخطوات | النتيجة المتوقعة |
|---|---|---|
| **إضافة عميل جديد** | استخدام `AddClientModal`، إدخال الاسم، الهاتف، الهوية | حفظ العميل، عدم تكرار رقم الهاتف/الهوية |
| **تحرير بيانات عميل** | تعديل رقم الهاتف أو الملاخظات | تحديث البيانات وظهور رسالة نجاح |
| **عرض كشف حساب** | الدخول لصفحة تفاصيل العميل والذهاب لتبويب الحسابات | عرض جميع العمليات المالية والمتبقي بدقة |
| **البحث عن عميل** | البحث بالاسم أو رقم الهاتف أو الهوية | ظهور النتيجة الصحيحة بسرعة |

### 3.3 إدارة الطلبات والعقود (Order Management)
صفحات: `/admin/neworders`, `/admin/track_order/[id]`, `/admin/endedorders`
| الحالة | الخطوات | النتيجة المتوقعة |
|---|---|---|
| **إنشاء طلب جديد** | اختيار عميل، اختيار عاملة (Homemaid)، تحديد نوع العقد | إنشاء الطلب بنجاح، تغيير حالة العاملة لـ "محجوز" |
| **إصدار عقد** | الضغط على "إنشاء عقد"، اختيار القالب | تحميل ملف PDF يحتوي بيانات العميل والعاملة الصحيحة |
| **تتبع الطلب** | تغيير حالة الطلب (مثلاً: "تم التأشير") في `track_order` | تحديث شريط الحالة (Timeline) وحفظ التاريخ |
| **إلغاء الطلب** | طلب إلغاء، إدخال سبب الإلغاء | تحرير العاملة (تصبح متاحة)، وتغيير حالة الطلب لـ "ملغي" |
| **التقييم** | إضافة تقييم للطلب بعد الانتهاء | حفظ التقييم وعرضه في التقارير |

### 3.4 الموارد البشرية والسير الذاتية (HR & Homemaids)
صفحات: `/admin/newhomemaids`, `/admin/cvdetails`, `/admin/workersstatus`
| الحالة | الخطوات | النتيجة المتوقعة |
|---|---|---|
| **إضافة عاملة** | إدخال البيانات الأساسية، المهارات، ورفع الصور | الحفظ بنجاح، ظهور العاملة في قائمة "الجدد" |
| **تصفية البحث** | تصفية حسب الجنسية، العمر، الديانة، الحالة الاجتماعية | ظهور النتائج المطابقة فقط |
| **تعديل الحالة** | تغيير الحالة من "جديد" إلى "مرفوض" أو "مؤجر" | التحديث الفوري في قواعد البيانات والقوائم |
| **عرض CV** | فتح صفحة تفاصيل العاملة (CV) | عرض وتنسيق البيانات والصور بشكل سليم للطباعة/المشاركة |

### 3.5 العمليات اللوجستية (Arrivals & Housing)
صفحات: `/admin/housedarrivals`, `/admin/arrival-list`
| الحالة | الخطوات | النتيجة المتوقعة |
|---|---|---|
| **تسجيل وصول** | إدخال بيانات الرحلة (رقم الرحلة، المطار، الوقت) | ظهور العاملة في قائمة "الوصول" وتنبيه الموظف المختص |
| **التسجيل في السكن** | نقل عاملة إلى السكن (Housing)، تحديد الغرفة | تحديث حالة العاملة ومكان تواجدها |
| **تسجيل خروج** | تسجيل خروج من السكن (تسليم للعميل) | تسجيل وقت الخروج وتحديث الحالة |

### 3.6 المالية (Finance)
صفحات: `/admin/cashtable`, `/admin/taxation`
| الحالة | الخطوات | النتيجة المتوقعة |
|---|---|---|
| **سند قبض** | إنشاء سند قبض لعميل مقابل طلب | تحديث رصيد العميل، الرصيد النقدي (الصندوق)، وإصدار السند |
| **سند صرف** | تسجيل مصروف عام أو رواتب | خصم المبلغ من الصندوق وتسجيله في المصروفات |
| **تقرير الضريبة** | عرض تقرير ضريبي لفترة محددة | حساب القيم المضافة بدقة بناءً على السندات |

---

## 4. أدوات الأتمتة المقترحة (Automation Suggestions)
لتحسين الجودة، يُنصح بتطبيق الاختبارات الآلية تدريجياً:
- **Jest / React Testing Library:** لاختبار المكونات (Components) مثل النماذج والأزرار بشكل منعزل.
- **Cypress / Playwright:** لعمل سيناريوهات E2E (مثل: تسجيل دخول -> إنشاء طلب -> طباعة عقد).
- **Postman / Insomnia:** لاختبار الـ API Endpoints في مجلد `pages/api`.

---

## 5. قائمة التحقق السريعة قبل النشر (Pre-Deployment Checklist)
- [ ] لا توجد أخطاء Console حمراء في الصفحات الرئيسية.
- [ ] عملية تسجيل الدخول والخروج تعمل.
- [ ] إنشاء طلب جديد يعمل حتى النهاية.
- [ ] طباعة العقود والسندات تعمل وتظهر البيانات بشكل صحيح.
- [ ] صلاحيات المستخدمين مطبقة (لا يستطيع الموظف العادي حذف بيانات حساسة).
- [ ] النسخ الاحتياطي لقاعدة البيانات يعمل.

---

**ملاحظة:** يتم تحديث هذه الخطة دورياً مع إضافة ميزات جديدة للنظام.
