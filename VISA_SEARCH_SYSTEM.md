# نظام تحسين رقم التأشيرة في ربط إدارة المكاتب

## نظرة عامة
تم تطوير نظام تحسين لرقم التأشيرة في ربط إدارة المكاتب يتيح للمستخدمين البحث في التأشيرات المرتبطة بالعميل واختيار رقم التأشيرة المناسب أو إضافة رقم جديد.

## المكونات المضافة

### 1. API Endpoint للبحث في التأشيرات
**الملف:** `pages/api/visa/search.ts`

- **الوظيفة:** البحث في التأشيرات المرتبطة بعميل محدد
- **المعاملات:**
  - `clientID`: معرف العميل (مطلوب)
  - `searchTerm`: مصطلح البحث (اختياري)
- **الاستجابة:** قائمة التأشيرات مع التفاصيل الأساسية

### 2. مكون VisaSelector
**الملف:** `components/VisaSelector.tsx`

**المميزات:**
- البحث التلقائي في التأشيرات
- عرض قائمة منسدلة بالنتائج
- خيار "إضافة رقم تأشيرة أخرى" مع مودال
- دعم البحث باللغة العربية
- واجهة مستخدم سهلة الاستخدام

**الخصائص:**
- `value`: القيمة الحالية
- `onChange`: دالة تحديث القيمة
- `clientID`: معرف العميل
- `placeholder`: نص التوضيح
- `className`: فئات CSS إضافية
- `error`: رسالة خطأ

### 3. تحديث مكون InfoCard
**الملف:** `components/InfoCard.tsx`

**التحديثات:**
- إضافة دعم لنوع حقل التأشيرة (`fieldType: 'visa'`)
- إضافة خاصية `clientID` لربط العميل
- دمج مكون `VisaSelector` في واجهة التعديل

### 4. تحديث صفحة track_order
**الملف:** `pages/admin/track_order/[id].tsx`

**التحديثات:**
- تحديث حقل "رقم التأشيرة" لاستخدام النظام الجديد
- إضافة `fieldType: 'visa'` للحقل
- تمرير `clientID` لمكون InfoCard

## كيفية الاستخدام

### 1. في صفحة تتبع الطلب
عند النقر على "تعديل" في قسم "الربط مع إدارة المكاتب":

1. **البحث التلقائي:** ابدأ بكتابة رقم التأشيرة
2. **اختيار من القائمة:** اختر من التأشيرات الموجودة
3. **إضافة جديدة:** اضغط على "إضافة رقم تأشيرة أخرى" لإدخال رقم جديد

### 2. واجهة المستخدم
- **حقل البحث:** يدعم البحث باللغة العربية
- **القائمة المنسدلة:** تعرض النتائج مع التفاصيل الإضافية
- **مودال الإضافة:** واجهة بسيطة لإدخال رقم جديد

## المميزات التقنية

### 1. البحث الذكي
- البحث في أرقام التأشيرات
- دعم البحث الجزئي
- ترتيب النتائج حسب تاريخ الإنشاء

### 2. تجربة المستخدم
- واجهة سهلة الاستخدام
- دعم اللغة العربية
- استجابة سريعة
- رسائل خطأ واضحة

### 3. الأمان
- التحقق من صحة البيانات
- حماية من SQL Injection
- معالجة الأخطاء

## التطوير المستقبلي

### إمكانيات التحسين:
1. **البحث المتقدم:** إضافة فلاتر إضافية (الجنسية، المهنة، إلخ)
2. **التخزين المؤقت:** تحسين الأداء مع التخزين المؤقت
3. **التحقق من التكرار:** منع إدخال أرقام تأشيرة مكررة
4. **التصدير:** إمكانية تصدير قائمة التأشيرات

## الاختبار

لاختبار النظام:
1. انتقل إلى صفحة تتبع الطلب
2. انقر على "تعديل" في قسم "الربط مع إدارة المكاتب"
3. جرب البحث في حقل "رقم التأشيرة"
4. اختبر إضافة رقم تأشيرة جديد

## الدعم الفني

في حالة وجود مشاكل:
1. تحقق من وجود العميل في النظام
2. تأكد من وجود تأشيرات مرتبطة بالعميل
3. راجع سجلات الأخطاء في وحدة التحكم
